# Implementation Plan

- [ ] 1. 创建项目基础结构和配置文件
  - 创建扩展目录结构，包含所有必要的文件夹
  - 编写 manifest.json 文件，配置扩展基本信息、权限和内容脚本
  - 创建 sites.json 配置文件，定义支持的网站和对应选择器
  - _Requirements: 2.1, 2.2, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2_

- [ ] 2. 实现国际化支持系统
  - 创建 locales 目录结构，包含 en 和 zh_CN 子目录
  - 编写英文和中文的 messages.json 文件，定义所有需要的文案
  - 在 manifest.json 中配置默认语言设置
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 3. 开发核心内容脚本架构
  - [ ] 3.1 实现 SiteManager 类
    - 编写站点配置加载和管理逻辑
    - 实现当前站点识别和匹配功能
    - 添加站点支持检查方法
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2_

  - [ ] 3.2 实现 ClipboardManager 类
    - 编写纯文本提取函数，去除 HTML 标签和 Markdown 格式
    - 实现剪贴板写入功能，包含错误处理和降级方案
    - 添加复制成功反馈机制
    - _Requirements: 1.2, 1.3_

  - [ ] 3.3 实现 ButtonInjector 类
    - 编写 MutationObserver 逻辑，监听 DOM 变化
    - 实现按钮创建和样式设置功能
    - 编写按钮注入逻辑，确保不重复添加
    - _Requirements: 1.1, 1.4, 6.1, 6.2, 6.3, 6.4_

- [ ] 4. 集成所有组件并实现主要功能
  - 在 content.js 中初始化所有管理类
  - 实现扩展启动流程，包含站点检查和组件初始化
  - 添加按钮点击事件处理，连接复制功能
  - 实现错误处理和日志记录
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 5. 优化用户体验和样式
  - 设计和实现复制按钮的 CSS 样式
  - 确保按钮在不同网站主题下的可见性
  - 添加按钮悬停效果和点击反馈
  - 优化按钮位置，避免遮挡重要内容
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 6. 实现配置系统的扩展性
  - 完善 sites.json 的数据结构，支持自定义样式配置
  - 实现配置文件的动态加载和更新机制
  - 添加配置验证和错误处理
  - 为未来的选项页面预留接口
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 7. 编写单元测试
  - 为 ClipboardManager 的纯文本提取功能编写测试
  - 为 SiteManager 的站点识别逻辑编写测试
  - 为 ButtonInjector 的按钮创建功能编写测试
  - 设置测试环境和运行脚本
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 8. 进行浏览器兼容性测试
  - 在 Chrome 浏览器中加载和测试扩展功能
  - 在 Edge 浏览器中验证扩展兼容性
  - 在 Firefox 浏览器中测试 Manifest V3 支持
  - 修复发现的兼容性问题
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 9. 在目标网站进行功能验证
  - 在 ChatGPT (chat.openai.com) 上测试按钮注入和复制功能
  - 在 DeepSeek (deepseek.com) 上验证选择器准确性
  - 在豆包 (doubao.com) 上测试中文界面支持
  - 在 Kimi (kimi.moonshot.ai) 上进行完整功能测试
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 10. 完善错误处理和边界情况
  - 实现站点配置加载失败的降级处理
  - 添加剪贴板 API 不可用时的备用方案
  - 处理 DOM 元素不存在或被移除的情况
  - 添加网络连接问题的处理逻辑
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 11. 优化性能和资源使用
  - 优化 MutationObserver 的监听范围，减少性能开销
  - 实现按钮缓存机制，避免重复创建
  - 添加防抖逻辑，处理快速 DOM 变化
  - 测试大量消息场景下的性能表现
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 12. 准备扩展发布包
  - 创建构建脚本，可选使用 esbuild 进行代码打包
  - 生成扩展图标和必要的资源文件
  - 编写用户友好的 README 文档
  - 创建扩展商店发布用的 ZIP 包
  - _Requirements: 2.1, 2.2, 7.3_